<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-request.html">
<link rel="import" href="./charon-auth-token-manager.html">

<script>
  (function() {
    'use strict';
    var CharonServiceBase = Polymer.Class({
      is: 'charon-service-base',

      _authTokenManager: document.createElement('charon-auth-token-manager'),
      _endpoint: 'http://localhost:3000',
      properties: {},

      created: function() {},

      invoke: function(apiPath, tokenScope) {
        var _this = this;
        var req = document.createElement('iron-request');
        return this._authTokenManager.getToken(tokenScope)
          .then(function(token) {
            return req.send({
              url: _this._getUrl(apiPath),
              headers: {
                'x-access-token': token
              },
              handleAs: 'json'
            });
          })
          .then(function() {
            return req.response;
          });
      },

      _getUrl: function(apiPath) {
        return this._endpoint + '/' + apiPath;
      }
    });

    document.registerElement('charon-service-base', CharonServiceBase);
  })();
</script>
